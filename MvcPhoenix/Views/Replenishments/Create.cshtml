@model MvcPhoenix.Models.SuggestedBulkOrder
@{ ViewBag.Title = "Replenishment Order"; }

<h4>Create Suggested Replenishment Order(s)</h4>

@*@using (Ajax.BeginForm("CreateSuggestedOrder", "BulkOrders",*@
@using (Ajax.BeginForm("CreateSuggestedOrder", "Replenishments",
    new AjaxOptions
    {
        UpdateTargetId = "dvGridPlaceHolder",
        LoadingElementId = "dvspinner",
        OnBegin = "ClearGridAndAddButton()",
        OnSuccess = "ShowAddButton()"
    }))
{

    <div class="well well-sm">
        @Html.DropDownListFor(m => m.clientid, Model.ListOfClients, new { onchange = "GetDivisions()", id = "ClientID", @class = "form-control", @style = "width:40%;margin-bottom:5px;" })
        <div id="dvDivisions">
            <select name="DivisionID" id='DivisionID' class='form-control' style='width:40%;'>
                <option>Division</option>
            </select>
        </div>
        <input id="btnsubmit" type="submit" value="Create Suggested Order" class="btn btn-primary btn-sm" style="margin-top:8px;display:none;" />
    </div>


    <div id="dvspinner" style="display:none;">
        <img src="~/Content/images/ani-rebuild.gif" /> Creating order <img src="~/Content/images/ani-rebuild.gif" />
    </div>
}

<!-- set intial display:none and change in ajax event (move to partial?) -->
<div id="dvAddButton" style="display:none;margin:auto;text-align:center;margin-bottom:5px;margin-top:5px;">
    <button class="btn btn-warning btn-sm" onclick="SetupAddMode()">Add Product to Order</button>
</div>

<div id="dvGridPlaceHolder" style="height:400px;overflow-y:auto;">
    <!-- Placeholder for _SuggestedItems.cshtml -->
</div>

<!-- this div is a bootstrap modal (ajax content MUST be pushed into the inner div) -->
<div class="modal" id="modalouter" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div id="modalinner" style="background-color:white;">
                    <!-- Placeholder for _SuggestedItemEdit.cshtml -->
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Local javascript -->
<script type="text/javascript">
    function GetDivisions() {
        // temporarily hide the add button
        $('#dvAddButton').css({ 'display': 'none' });

        // empty the placeholder (visual only)
        document.getElementById("dvGridPlaceHolder").innerHTML = "";

        // if client is selected do the work
        if ($("#ClientID").val() > 0) {
            // show the button
            $('#btnsubmit').css({ 'display': 'inline-block' })
            // go get the data

            //  will not work in IIS var URL = "/BulkOrders/BuildDivisionDropDown/" + $("#ClientID").val();
            @*var URL = '@Url.Action("BuildDivisionDropDown", "BulkOrders", new { id = "-1" })';*@
            var URL = '@Url.Action("BuildDivisionDropDown", "Replenishments", new { id = "-1" })';
            URL = URL.replace('-1', $('#ClientID').val());

            $('#dvDivisions').load(URL);
        }
    }

    function ShowAddButton() {
        $('#dvAddButton').css({ 'display': 'inline-block' });
    }

    function ClearGridAndAddButton() {
        $('#dvAddButton').css({ 'display': 'none' });
        document.getElementById("dvGridPlaceHolder").innerHTML = "";
    }

    function SetupAddMode() {
        // build a new obj and show modal (have to replace cause action params are static)
        @*var URL = '@Url.Action("SetupNewItem", "BulkOrders", new { clientid = "-1" })';*@
        var URL = '@Url.Action("SetupNewItem", "Replenishments", new { clientid = "-1" })';
        URL = URL.replace('-1', $('#ClientID').val());
        $('#modalinner').load(URL);
        $('#modalouter').modal('show')
    }

</script>
