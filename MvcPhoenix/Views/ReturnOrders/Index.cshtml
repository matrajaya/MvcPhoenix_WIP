@{
    ViewBag.Title = "Create Return Order";
}

<div class="row">
    <div class="col-lg-12">
        <img src="~/Content/images/logos/oltlogo.jpg" style="width: auto; height: 73px; float: right" alt="Odyssey">
    </div>
    <div class="col-lg-12">
        <h1 class="page-header">@ViewBag.Title</h1>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-file-text-o fa-fw"></i> Client Selection</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        @Html.DropDownList("clientid", ApplicationService.ddlClientIDs(), new { @class = "form-control", onchange = "UpdateDivisionDD()" })
                    </div>
                    <div class="col-md-6">
                        <div id="dvPlaceholderDivision">
                            <select name="divisionid" id='divisionid' class='form-control'>
                                <option>Select Division</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-file-text-o fa-fw"></i> Status Selection</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-4">
                        @Html.DropDownList("bulkstatusid", new SelectList(Enum.GetValues(typeof(ApplicationService.StockStatusChoice))), new { @class = "form-control" })
                    </div>
                    <div class="col-md-4">
                        @Html.DropDownList("stockstatusid", new SelectList(Enum.GetValues(typeof(ApplicationService.StockStatusChoice))), new { @class = "form-control" })
                    </div>
                    <div class="col-md-4">
                        @Ajax.ActionLink("Search", "Search", "ReturnOrders", new AjaxOptions { OnSuccess = "UpdateAllPartials" }, new { @class = "btn btn-success btn-block form-control" })
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div id="dvBulkPlaceHolder" class="col-md-6"></div>
    <div id="dvStockPlaceHolder" class="col-md-6"></div>
</div>
<div class="row">
    <div id="dvMarkedBulkPlaceHolder" class="col-md-6"></div>
    <div id="dvMarkedStockPlaceHolder" class="col-md-6"></div>
</div>

<div class="form-group row center-block">
    <div class="col-md-12 text-center" id="dvspinner" style="display:none; font-size:large">
        <i class="fa fa-circle-o-notch fa-5x fa-spin"></i> Building Order...
    </div>
</div>

<div id="dvCreateRow" class="row hidden">
    <div class="col-md-4 col-md-offset-4">
        @using (Html.BeginForm("CreateReturnOrder", "ReturnOrders", FormMethod.Post, new { id = "orderform" }))
        {
            <input type="hidden" id="hiddenclientid" name="hiddenclientid" />
            <input type="hidden" id="hiddendivisionid" name="hiddendivisionid" />
            <input id="SubmitOrder" type="submit" value="Create Return Order" onclick="return confirm('Create Return Order?');" class="btn btn-success btn-block" />
        }
    </div>
</div>

<script type="text/javascript">
    // animation when form is submitted
    $("#orderform").submit(function (e) {
        var myclientid = $('#clientid').val();
        $("#hiddenclientid").val(myclientid);
        var mydivisionid = $('#divisionid').val();
        $("#hiddendivisionid").val(mydivisionid);
        $("#dvspinner").show();
    });

    function UpdateDivisionDD() {
        var myclientid = $('#clientid').val();
        var myurl = '@Url.Action("BuildDivisionDropDown", "ReturnOrders")';
        $("#divisionid").load(myurl, { id: myclientid });

        // empty the divs holding the partials
        $("#dvBulkPlaceHolder").empty();
        $("#dvStockPlaceHolder").empty();
        $("#dvMarkedBulkPlaceHolder").empty();
        $("#dvMarkedStockPlaceHolder").empty();
        $("#dvCreateRow").addClass("hidden");
    }

    function UpdateBulkPartials() {
        var myclientid = $('#clientid').val();
        var mybulkstatusid = $('#bulkstatusid').val();
        var mystockstatusid = $('#stockstatusid').val();
        var mydivisionid = $('#divisionid').val();
        var myurl1 = '@Url.Action("LoadBulkPartial", "ReturnOrders")';
        $("#dvBulkPlaceHolder").load(myurl1, { clientid: myclientid, bulkstatusid: mybulkstatusid, divisionid: mydivisionid });
        var myurl3 = '@Url.Action("LoadMarkedBulkPartial", "ReturnOrders")';
        $("#dvMarkedBulkPlaceHolder").load(myurl3);
        ShowHideCreateButton()
    }

    function UpdateStockPartials() {
        var myclientid = $('#clientid').val();
        var mybulkstatusid = $('#bulkstatusid').val();
        var mystockstatusid = $('#stockstatusid').val();
        var mydivisionid = $('#divisionid').val();
        var myurl2 = '@Url.Action("LoadStockPartial", "ReturnOrders")';
        $("#dvStockPlaceHolder").load(myurl2, { clientid: myclientid, stockstatusid: mystockstatusid, divisionid: mydivisionid });
        var myurl4 = '@Url.Action("LoadMarkedStockPartial", "ReturnOrders")';
        $("#dvMarkedStockPlaceHolder").load(myurl4);
        ShowHideCreateButton()
    }

    function ShowHideCreateButton() {
        $.get('@Url.Action("fnMarkedCount", "ReturnOrders")', function (markedCount) {
            if (parseInt(markedCount) >= 1) {
                $("#dvCreateRow").removeClass("hidden");
                $("#SubmitOrder").val("Create Return Order - " + markedCount + ' Item(s)');
            }
            else {
                $("#dvCreateRow").addClass("hidden");
            }
        });
    }

    function UpdateAllPartials() {
        UpdateBulkPartials()
        UpdateStockPartials()
    }
</script>