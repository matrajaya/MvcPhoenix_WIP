@{
    ViewBag.Title = "Receive Known Material";
}
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="row">
        <div class="col-lg-12">
            <img src="~/Content/images/logos/oltlogo.jpg" style="width: auto; height: 73px; float: right" alt="acme logo">
        </div>
        <div class="col-lg-12">
            <h4 class="page-header">
                @ViewBag.Title
            </h4>
        </div>
    </div>
    <div class="form-group">
        <div class="col-lg-12 row">
            <i class="fa fa-arrow-circle-left"></i> @Html.ActionLink("Back to Receiving Main", "Index")
        </div>
    </div>
    <!-- Page Heading -->


    <!-- Build a form to submit the productmasterid back to check for open order items -->
    @using (Ajax.BeginForm("CheckForOpenOrderItems", "Receiving", new AjaxOptions
    {
        UpdateTargetId = "dvPlaceholderOpenOrderItems",
        OnBegin = "$('#dvPlaceholderOpenOrderItems').removeClass('hidden')",
        InsertionMode = InsertionMode.Replace, HttpMethod="POST", LoadingElementId="dvSpinner", LoadingElementDuration=4
    }))
    {

        <div id="dvPlaceholderClientID">
            @Html.DropDownList("ClientID", (List<SelectListItem>)ViewBag.ListOfClients, new { onchange = "OnChangeClientID()", @class = "form-control", @style = "width:35%;" })
        </div>

        <div id="dvPlaceholderMasterCode" class="hidden">
            <select name='productmasterid' id='productmasterid' onchange="OnChangeMasterCode()" class='form-control' style='width:50%;'>
                <!-- Placeholder for options values  -->
            </select>
        </div>

        <div id="dvPlaceholderCheckOrdersButton" class="hidden">
            <input id="btnsubmit" type="submit" value="Check Open Orders" onclick="OnClickCheckOrders()" />
            <span id="dvSpinner" style="display:none;">
                <img src="~/Content/images/ani-rebuild.gif" />
            </span>
        </div>   

        <br />
        <div id="dvPlaceholderOpenOrderItems" class="hidden">
            <!-- Placeholder for Open Order Items -->
        </div>
        <br />
        
    <div id="dvPlaceholderNew" class="hidden">
        <a id="aNewContainer" class="btn btn-primary">Enter New Container</a>
    </div>

    }

</div>

<script type="text/javascript">
    function OnChangeClientID() {
        // hide/show controls
        $("#dvPlaceholderMasterCode").removeClass("hidden");
        $("#dvPlaceholderCheckOrdersButton").addClass("hidden");
        $("#dvPlaceholderOpenOrderItems").empty();
        $("#dvPlaceholderNew").addClass("hidden");

        // call action that returns DD of Mastercodes
        var url = '@Url.Action("BuildProductMasterDropDown", "Receiving")';
        var data = $('#ClientID').val()
        $("#productmasterid").load(url, { id: data });

    }

    function OnChangeMasterCode() {
        // show the button to check for open order items
        $("#dvPlaceholderOpenOrderItems").empty();
        $("#dvPlaceholderCheckOrdersButton").removeClass("hidden");
        $("#dvPlaceholderNew").addClass("hidden");
    }

    function OnClickCheckOrders()
    {
        $("#dvPlaceholderOpenOrderItems").empty();
        $("#dvPlaceholderNew").removeClass("hidden");

        // build the New url to include the productmasterid
        var myid=$("#productmasterid").val();
        var url = '@Url.Action("CreateContainerReceipt", "Receiving")';
        url = url + "/" + myid;
        $("#aNewContainer").prop("href", url);

    }
</script>
